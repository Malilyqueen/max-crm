SPEC COMPLÃˆTE â€” SystÃ¨me de MÃ©moire Longue DurÃ©e pour M.A.X.
Version : 1.0
Date : 2025-12-10
Statut : Proposition technique (non exÃ©cutÃ©e)
ğŸ¯ Objectif du systÃ¨me
Permettre Ã  M.A.X. de mÃ©moriser, classer, et exploiter intelligemment trois types d'informations durables :
Objectifs (rÃ©sultats Ã  atteindre, KPIs, ambitions chiffrÃ©es)
Profil (prÃ©fÃ©rences, contraintes, style de communication, secteur)
Notes longues (rÃ©flexions, contexte business, nuances stratÃ©giques)
Le systÃ¨me doit :
âœ… DÃ©tecter l'intention de mÃ©morisation en langage naturel
âœ… Classifier automatiquement l'information (avec confirmation si ambiguÃ«)
âœ… Ã‰viter les hallucinations (ne mÃ©moriser que ce qui est explicite)
âœ… Permettre l'oubli (soft delete avec archivage)
âœ… Charger automatiquement ces mÃ©moires pour contextualiser les rÃ©ponses
PARTIE A â€” FONDATIONS DATA
1. SchÃ©ma SQL de rÃ©fÃ©rence
Table tenant_goals (Objectifs mesurables)
Voici Ã  quoi pourrait ressembler le schÃ©ma pour stocker les objectifs business :
-- Table pour les objectifs business du tenant
CREATE TABLE tenant_goals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id VARCHAR(255) NOT NULL,
  
  -- Contenu de l'objectif
  goal_text TEXT NOT NULL, -- Description complÃ¨te de l'objectif
  goal_category VARCHAR(50), -- Ex: 'conversion', 'retention', 'acquisition', 'automation'
  
  -- Mesures & progression
  target_value NUMERIC, -- Valeur cible (ex: 5000 clients)
  current_value NUMERIC, -- Progression actuelle (ex: 3200 clients)
  unit VARCHAR(50), -- UnitÃ© de mesure (ex: 'clients', 'euros', 'pourcentage')
  
  -- TemporalitÃ©
  deadline TIMESTAMP, -- Date limite (ex: '2025-03-31')
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- Statut & prioritÃ©
  status VARCHAR(20) DEFAULT 'actif', -- 'actif' / 'atteint' / 'abandonnÃ©' / 'archivÃ©'
  priority INTEGER DEFAULT 50, -- 1-100 (100 = max prioritÃ©)
  
  -- Soft delete
  archived BOOLEAN DEFAULT FALSE,
  archived_at TIMESTAMP,
  
  -- MÃ©tadonnÃ©es
  created_by VARCHAR(255), -- ID utilisateur qui a crÃ©Ã© l'objectif
  metadata JSONB -- Infos additionnelles flexibles
);

-- Index pour performances
CREATE INDEX idx_tenant_goals_tenant ON tenant_goals(tenant_id);
CREATE INDEX idx_tenant_goals_status ON tenant_goals(status);
CREATE INDEX idx_tenant_goals_archived ON tenant_goals(archived);
CREATE INDEX idx_tenant_goals_priority ON tenant_goals(priority DESC);
Table tenant_memory (existante, avec nouveaux memory_type)
La table tenant_memory existe dÃ©jÃ . Voici comment elle serait utilisÃ©e pour Profil et Notes :
-- Table existante tenant_memory (pour rappel)
-- On ajoute conceptuellement de nouveaux memory_type :

-- Nouveaux memory_type possibles :
-- - 'identity' (dÃ©jÃ  existant - business model, secteur)
-- - 'profile' (NOUVEAU - prÃ©fÃ©rences, canaux, contraintes)
-- - 'note' (NOUVEAU - notes longues contextuelles)
-- - 'business_context' (dÃ©jÃ  existant - objectifs, contraintes)
-- - 'preference' (dÃ©jÃ  existant - ton, langue)

-- Exemple de structure (rÃ©fÃ©rence) :
/*
CREATE TABLE tenant_memory (
  id UUID PRIMARY KEY,
  tenant_id VARCHAR(255) NOT NULL,
  memory_key VARCHAR(255) NOT NULL,
  memory_value JSONB NOT NULL,
  memory_type VARCHAR(50) NOT NULL, -- 'identity', 'profile', 'note', etc.
  scope VARCHAR(50) DEFAULT 'global',
  priority INTEGER DEFAULT 50,
  expires_at TIMESTAMP, -- NULL pour mÃ©moire permanente
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_accessed_at TIMESTAMP,
  access_count INTEGER DEFAULT 0,
  
  -- Soft delete (Ã  ajouter si pas dÃ©jÃ  prÃ©sent)
  archived BOOLEAN DEFAULT FALSE,
  archived_at TIMESTAMP
);
*/
Table max_long_term_notes (optionnelle, alternative Ã  tenant_memory)
Si on veut une table dÃ©diÃ©e pour les notes longues (non structurÃ©es), voici Ã  quoi elle pourrait ressembler :
-- ALTERNATIVE : Table dÃ©diÃ©e pour notes longues
-- (Ou bien utiliser tenant_memory avec memory_type = 'note')

CREATE TABLE max_long_term_notes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id VARCHAR(255) NOT NULL,
  
  -- Contenu de la note
  note_text TEXT NOT NULL,
  note_category VARCHAR(50), -- 'reflexion', 'contexte', 'nuance', 'emotion'
  
  -- Contexte
  related_to VARCHAR(50), -- 'lead', 'objectif', 'general'
  related_id UUID, -- ID de l'entitÃ© liÃ©e (si applicable)
  
  -- MÃ©tadonnÃ©es
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- Soft delete
  archived BOOLEAN DEFAULT FALSE,
  archived_at TIMESTAMP,
  
  -- MÃ©tadonnÃ©es flexibles
  metadata JSONB
);

CREATE INDEX idx_notes_tenant ON max_long_term_notes(tenant_id);
CREATE INDEX idx_notes_archived ON max_long_term_notes(archived);
Recommandation : Utiliser tenant_memory avec memory_type = 'note' pour l'instant (plus simple, moins de tables).
2. Exemples de donnÃ©es
Exemple 1 : Objectif dans tenant_goals
Cas utilisateur : "Note que mon objectif est d'atteindre 5000 clients avant mars 2025."
-- Ligne INSERT de rÃ©fÃ©rence
INSERT INTO tenant_goals (
  tenant_id,
  goal_text,
  goal_category,
  target_value,
  current_value,
  unit,
  deadline,
  status,
  priority
) VALUES (
  'macrea',
  'Atteindre 5000 clients actifs',
  'acquisition',
  5000,
  3200, -- progression actuelle (si connue)
  'clients',
  '2025-03-31 23:59:59',
  'actif',
  90
);
Payload JSON (API) :
{
  "tenant_id": "macrea",
  "goal_text": "Atteindre 5000 clients actifs",
  "goal_category": "acquisition",
  "target_value": 5000,
  "current_value": 3200,
  "unit": "clients",
  "deadline": "2025-03-31T23:59:59Z",
  "status": "actif",
  "priority": 90
}
Exemple 2 : PrÃ©fÃ©rence dans tenant_memory
Cas utilisateur : "Retiens que je prÃ©fÃ¨re WhatsApp aux emails pour contacter mes leads."
-- Ligne INSERT de rÃ©fÃ©rence
INSERT INTO tenant_memory (
  tenant_id,
  memory_key,
  memory_value,
  memory_type,
  scope,
  priority,
  expires_at
) VALUES (
  'macrea',
  'canal_contact_prefere',
  '"WhatsApp"'::jsonb,
  'profile',
  'global',
  80,
  NULL -- Jamais expirÃ©e
);
Payload JSON (API) :
{
  "tenant_id": "macrea",
  "memory_key": "canal_contact_prefere",
  "memory_value": "WhatsApp",
  "memory_type": "profile",
  "scope": "global",
  "priority": 80,
  "expires_at": null
}
Exemple 3 : Contrainte dans tenant_memory
Cas utilisateur : "Note que je ne fais jamais de publicitÃ© Facebook, budget trop limitÃ©."
INSERT INTO tenant_memory (
  tenant_id,
  memory_key,
  memory_value,
  memory_type,
  scope,
  priority,
  expires_at
) VALUES (
  'macrea',
  'contrainte_marketing',
  '{"interdiction": "publicitÃ© Facebook", "raison": "budget limitÃ©"}'::jsonb,
  'profile',
  'global',
  85,
  NULL
);
Payload JSON (API) :
{
  "tenant_id": "macrea",
  "memory_key": "contrainte_marketing",
  "memory_value": {
    "interdiction": "publicitÃ© Facebook",
    "raison": "budget limitÃ©"
  },
  "memory_type": "profile",
  "scope": "global",
  "priority": 85,
  "expires_at": null
}
Exemple 4 : Note longue dans tenant_memory
Cas utilisateur : "Garde en tÃªte que je suis en plein pivot business, je passe du B2C au B2B."
INSERT INTO tenant_memory (
  tenant_id,
  memory_key,
  memory_value,
  memory_type,
  scope,
  priority,
  expires_at
) VALUES (
  'macrea',
  'note_pivot_b2b',
  '{"contexte": "pivot B2C vers B2B", "date": "2025-12-10", "impact": "stratÃ©gie leads Ã  adapter"}'::jsonb,
  'note',
  'global',
  70,
  NULL
);
Payload JSON (API) :
{
  "tenant_id": "macrea",
  "memory_key": "note_pivot_b2b",
  "memory_value": {
    "contexte": "pivot B2C vers B2B",
    "date": "2025-12-10",
    "impact": "stratÃ©gie leads Ã  adapter"
  },
  "memory_type": "note",
  "scope": "global",
  "priority": 70,
  "expires_at": null
}
3. Exemples de requÃªtes SQL (lecture)
RÃ©cupÃ©rer tous les objectifs actifs d'un tenant
SELECT 
  id,
  goal_text,
  goal_category,
  target_value,
  current_value,
  unit,
  deadline,
  status,
  priority
FROM tenant_goals
WHERE tenant_id = 'macrea'
  AND archived = FALSE
  AND status = 'actif'
ORDER BY priority DESC, deadline ASC NULLS LAST;
RÃ©cupÃ©rer le profil complet d'un tenant
SELECT 
  memory_key,
  memory_value,
  priority,
  created_at,
  updated_at
FROM tenant_memory
WHERE tenant_id = 'macrea'
  AND memory_type = 'profile'
  AND (archived IS NULL OR archived = FALSE)
  AND (expires_at IS NULL OR expires_at > NOW())
ORDER BY priority DESC;
RÃ©cupÃ©rer les notes longues rÃ©centes
SELECT 
  memory_key,
  memory_value,
  created_at
FROM tenant_memory
WHERE tenant_id = 'macrea'
  AND memory_type = 'note'
  AND (archived IS NULL OR archived = FALSE)
ORDER BY created_at DESC
LIMIT 10;
PARTIE B â€” LOGIQUE IA & TOOLS (RÃˆGLE #8)
1. DÃ©tection de l'intention de mÃ©morisation
M.A.X. doit identifier qu'une phrase contient une intention de mÃ©morisation via deux mÃ©canismes complÃ©mentaires :
A. DÃ©tection lexicale (dÃ©clencheurs explicites)
Liste de patterns Ã  dÃ©tecter dans le message utilisateur : DÃ©clencheurs directs :
"note que..."
"retiens que..."
"garde en tÃªte..."
"enregistre..."
"prends note..."
"souviens-toi que..."
"n'oublie pas..."
"Ã  partir de maintenant..."
"considÃ¨re que..."
"place Ã§a dans..."
DÃ©clencheurs d'importance :
"c'est important pour moi"
"c'est crucial"
"c'est essentiel"
DÃ©clencheurs de catÃ©gorie :
"mon objectif est..."
"ajoute Ã§a Ã  mes objectifs"
"dans mon profil..."
"ma prÃ©fÃ©rence c'est..."
B. DÃ©tection sÃ©mantique (dÃ©clencheurs implicites)
MÃªme sans mot-clÃ© explicite, certaines formulations structurelles indiquent une information Ã  mÃ©moriser : Patterns objectifs :
"Mon objectif [pÃ©riode] est [rÃ©sultat mesurable]"
Ex: "Mon objectif cette annÃ©e est 200 clients"
"Je veux atteindre [mÃ©trique]"
Ex: "Je veux atteindre 50kâ‚¬ de CA mensuel"
"Augmenter [chose] de [pourcentage/valeur]"
Ex: "Augmenter mes conversions WhatsApp de 30%"
Patterns profil/prÃ©fÃ©rences :
"Je prÃ©fÃ¨re [option A] Ã  [option B]"
Ex: "Je prÃ©fÃ¨re WhatsApp aux emails"
"Je travaille avec [cible]"
Ex: "Je travaille principalement avec des boutiques afro"
"Ma cible c'est [description]"
Ex: "Ma cible ce sont les mamans entrepreneures"
"Je ne fais jamais [action]"
Ex: "Je ne fais jamais de cold calling"
Patterns notes longues :
"Je suis en [situation]"
Ex: "Je suis en plein pivot"
"Actuellement, [contexte]"
Ex: "Actuellement, je manque de temps"
Phrases contenant Ã©motion + contexte business
Ex: "Je stresse avec les tÃ¢ches techniques"
2. Classification automatique
Une fois l'intention dÃ©tectÃ©e, M.A.X. doit classifier l'information dans l'une des 3 catÃ©gories :
ğŸŸ§ A. OBJECTIF (tenant_goals)
CritÃ¨res de classification : âœ… Contient un rÃ©sultat mesurable âœ… Peut Ãªtre associÃ© Ã  une mÃ©trique/KPI âœ… A une notion de progression (avant/aprÃ¨s, actuel/cible) âœ… Peut avoir une deadline âœ… Exprime une ambition business claire Exemples :
"Atteindre 5000 clients" â†’ goal_text, target_value: 5000, unit: clients
"Augmenter mes conversions de 20%" â†’ goal_category: conversion, target_value: 20, unit: pourcentage
"Automatiser mes relances avant mars" â†’ goal_text, deadline: 2025-03-31
Stockage : Table tenant_goals
ğŸŸ¦ B. PROFIL / PRÃ‰FÃ‰RENCE (tenant_memory avec memory_type='profile')
CritÃ¨res de classification : âœ… DÃ©crit une prÃ©fÃ©rence stable âœ… DÃ©finit un canal favorisÃ© âœ… Exprime une contrainte/interdiction âœ… DÃ©crit un style de communication âœ… DÃ©finit une cible client âœ… Informations business stables (secteur, modÃ¨le) Exemples :
"Je prÃ©fÃ¨re WhatsApp" â†’ memory_key: canal_contact_prefere, memory_value: "WhatsApp"
"Je ne fais jamais de pub Facebook" â†’ memory_key: contrainte_marketing, memory_value: {...}
"Je tutoie mes prospects" â†’ memory_key: style_communication, memory_value: "tutoiement"
"Ma cible = mamans entrepreneures" â†’ memory_key: cible_client, memory_value: "mamans entrepreneures"
Stockage : Table tenant_memory avec memory_type = 'profile'
ğŸŸ© C. NOTE LONGUE (tenant_memory avec memory_type='note')
CritÃ¨res de classification : âœ… Contexte Ã©volutif (pas permanent) âœ… RÃ©flexion personnelle âœ… Ã‰lÃ©ment Ã©motionnel âœ… Nuance stratÃ©gique âœ… Information importante mais non structurÃ©e Exemples :
"Je suis en plein pivot B2B" â†’ memory_key: note_pivot, memory_value: {...}
"Je manque de temps actuellement" â†’ memory_key: note_contrainte_temps, memory_value: {...}
"Je stresse avec les tÃ¢ches techniques" â†’ memory_key: note_emotion_tech, memory_value: {...}
Stockage : Table tenant_memory avec memory_type = 'note'
3. Gestion des ambiguÃ¯tÃ©s et contradictions
Cas 1 : Information ambiguÃ« (peut Ãªtre objectif OU prÃ©fÃ©rence)
Exemple : "Je veux automatiser mes relances"
Objectif ? (rÃ©sultat Ã  atteindre : "automatiser")
PrÃ©fÃ©rence ? (mÃ©thode de travail : "automatisation")
RÃ©ponse M.A.X. :
Je peux enregistrer ceci de deux faÃ§ons :

1ï¸âƒ£ Comme un **objectif** : "Automatiser les relances clients"
   â†’ Suivi de progression, deadline possible

2ï¸âƒ£ Comme une **prÃ©fÃ©rence stratÃ©gique** : "PrivilÃ©gier l'automatisation"
   â†’ AppliquÃ© Ã  toutes les recommandations futures

Comment veux-tu que je le classe ?
Cas 2 : Information contradictoire (mise Ã  jour)
Exemple : L'utilisateur avait dit "Je prÃ©fÃ¨re WhatsApp", puis dit "Finalement, je prÃ©fÃ¨re les emails" RÃ©ponse M.A.X. :
ğŸ“ Je note que tu prÃ©fÃ¨res maintenant les emails.

Actuellement, j'ai enregistrÃ© : "Canal prÃ©fÃ©rÃ© = WhatsApp"

Souhaites-tu que je mette Ã  jour cette prÃ©fÃ©rence vers "Email" ?
Action aprÃ¨s confirmation :
UPDATE tenant_memory SET memory_value = 'Email', updated_at = NOW() WHERE memory_key = 'canal_contact_prefere'
Cas 3 : Objectif dÃ©jÃ  existant
Exemple : L'utilisateur avait "Atteindre 3000 clients", puis dit "Mon objectif est 5000 clients" RÃ©ponse M.A.X. :
ğŸ“Š Ton objectif actuel est : "Atteindre 3000 clients" (progression : 65%)

Tu viens de mentionner un nouvel objectif : "Atteindre 5000 clients"

Options :
1ï¸âƒ£ **Remplacer** l'objectif actuel (3000 â†’ 5000)
2ï¸âƒ£ **Ajouter** un nouvel objectif distinct (garder les deux)
3ï¸âƒ£ **Archiver** l'ancien et crÃ©er le nouveau

Quelle option prÃ©fÃ¨res-tu ?
4. Soft Delete (archivage)
Logique d'archivage
Quand l'utilisateur demande d'oublier une information :
"Supprime cet objectif"
"Oublie cette prÃ©fÃ©rence"
"Efface cette note"
"Je n'ai plus cet objectif"
Action M.A.X. :
Identifier l'Ã©lÃ©ment concernÃ©
Marquer comme archivÃ© (archived = TRUE, archived_at = NOW())
Confirmer Ã  l'utilisateur
Exemple SQL :
-- Archiver un objectif
UPDATE tenant_goals
SET archived = TRUE, 
    archived_at = NOW(), 
    status = 'abandonnÃ©'
WHERE id = 'uuid-de-lobjectif'
  AND tenant_id = 'macrea';

-- Archiver une prÃ©fÃ©rence
UPDATE tenant_memory
SET archived = TRUE, 
    archived_at = NOW()
WHERE memory_key = 'canal_contact_prefere'
  AND tenant_id = 'macrea';
Lecture (ignorer les archives)
Toutes les requÃªtes de lecture doivent filtrer archived = FALSE :
-- Objectifs actifs uniquement
SELECT * FROM tenant_goals
WHERE tenant_id = 'macrea'
  AND archived = FALSE;

-- Profil actif uniquement
SELECT * FROM tenant_memory
WHERE tenant_id = 'macrea'
  AND memory_type = 'profile'
  AND (archived IS NULL OR archived = FALSE);
5. Architecture des Tools M.A.X.
Voici Ã  quoi pourraient ressembler les tools permettant Ã  M.A.X. de gÃ©rer la mÃ©moire longue :
Tool 1 : store_tenant_goal
Description : Enregistrer un nouvel objectif business Signature :
{
  "name": "store_tenant_goal",
  "description": "Enregistrer un objectif business mesurable dans la mÃ©moire long terme du tenant",
  "parameters": {
    "type": "object",
    "properties": {
      "goal_text": {
        "type": "string",
        "description": "Description complÃ¨te de l'objectif"
      },
      "goal_category": {
        "type": "string",
        "enum": ["acquisition", "conversion", "retention", "automation", "revenue", "other"],
        "description": "CatÃ©gorie de l'objectif"
      },
      "target_value": {
        "type": "number",
        "description": "Valeur cible (optionnel)"
      },
      "unit": {
        "type": "string",
        "description": "UnitÃ© de mesure (clients, euros, pourcentage, etc.)"
      },
      "deadline": {
        "type": "string",
        "format": "date-time",
        "description": "Date limite (optionnel)"
      },
      "priority": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "description": "PrioritÃ© (1-100, dÃ©faut 50)"
      }
    },
    "required": ["goal_text"]
  }
}
Exemple d'appel :
{
  "goal_text": "Atteindre 5000 clients actifs",
  "goal_category": "acquisition",
  "target_value": 5000,
  "unit": "clients",
  "deadline": "2025-03-31T23:59:59Z",
  "priority": 90
}
Tool 2 : store_tenant_profile
Description : Enregistrer une prÃ©fÃ©rence, contrainte, ou information de profil durable Signature :
{
  "name": "store_tenant_profile",
  "description": "Enregistrer une prÃ©fÃ©rence ou contrainte dans le profil long terme du tenant",
  "parameters": {
    "type": "object",
    "properties": {
      "profile_key": {
        "type": "string",
        "description": "ClÃ© identifiant la prÃ©fÃ©rence (ex: canal_contact_prefere)"
      },
      "profile_value": {
        "type": ["string", "object"],
        "description": "Valeur de la prÃ©fÃ©rence (texte simple ou objet JSON)"
      },
      "category": {
        "type": "string",
        "enum": ["canal", "style_communication", "contrainte", "cible_client", "methode_travail", "other"],
        "description": "CatÃ©gorie de la prÃ©fÃ©rence"
      },
      "priority": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "description": "PrioritÃ© (1-100, dÃ©faut 80)"
      }
    },
    "required": ["profile_key", "profile_value"]
  }
}
Exemple d'appel :
{
  "profile_key": "canal_contact_prefere",
  "profile_value": "WhatsApp",
  "category": "canal",
  "priority": 85
}
Tool 3 : store_long_term_note
Description : Enregistrer une note contextuelle, rÃ©flexion, ou nuance stratÃ©gique Signature :
{
  "name": "store_long_term_note",
  "description": "Enregistrer une note longue durÃ©e (contexte, rÃ©flexion, nuance)",
  "parameters": {
    "type": "object",
    "properties": {
      "note_text": {
        "type": "string",
        "description": "Contenu de la note"
      },
      "note_category": {
        "type": "string",
        "enum": ["reflexion", "contexte", "nuance", "emotion", "pivot", "other"],
        "description": "Type de note"
      },
      "related_to": {
        "type": "string",
        "enum": ["lead", "objectif", "general"],
        "description": "Contexte liÃ© (optionnel)"
      },
      "related_id": {
        "type": "string",
        "description": "ID de l'entitÃ© liÃ©e (optionnel)"
      }
    },
    "required": ["note_text"]
  }
}
Exemple d'appel :
{
  "note_text": "Je suis en plein pivot business, je passe du B2C au B2B",
  "note_category": "pivot",
  "related_to": "general"
}
Tool 4 : update_tenant_goal
Description : Mettre Ã  jour un objectif existant (progression, statut, deadline) Signature :
{
  "name": "update_tenant_goal",
  "description": "Mettre Ã  jour un objectif existant (progression, statut, ou modification)",
  "parameters": {
    "type": "object",
    "properties": {
      "goal_id": {
        "type": "string",
        "description": "ID de l'objectif Ã  mettre Ã  jour"
      },
      "current_value": {
        "type": "number",
        "description": "Nouvelle valeur de progression (optionnel)"
      },
      "status": {
        "type": "string",
        "enum": ["actif", "atteint", "abandonnÃ©", "archivÃ©"],
        "description": "Nouveau statut (optionnel)"
      },
      "goal_text": {
        "type": "string",
        "description": "Nouvelle description (optionnel)"
      },
      "deadline": {
        "type": "string",
        "format": "date-time",
        "description": "Nouvelle deadline (optionnel)"
      }
    },
    "required": ["goal_id"]
  }
}
Tool 5 : archive_memory_item
Description : Archiver (soft delete) un objectif, une prÃ©fÃ©rence, ou une note Signature :
{
  "name": "archive_memory_item",
  "description": "Archiver un Ã©lÃ©ment de mÃ©moire longue (objectif, profil, note)",
  "parameters": {
    "type": "object",
    "properties": {
      "item_type": {
        "type": "string",
        "enum": ["goal", "profile", "note"],
        "description": "Type d'Ã©lÃ©ment Ã  archiver"
      },
      "item_id": {
        "type": "string",
        "description": "ID de l'Ã©lÃ©ment (pour goal) ou memory_key (pour profile/note)"
      },
      "reason": {
        "type": "string",
        "description": "Raison de l'archivage (optionnel, pour traÃ§abilitÃ©)"
      }
    },
    "required": ["item_type", "item_id"]
  }
}
Exemple d'appel :
{
  "item_type": "goal",
  "item_id": "uuid-de-lobjectif",
  "reason": "Objectif abandonnÃ© par l'utilisateur"
}
Tool 6 : get_tenant_context
Description : Charger la mÃ©moire longue complÃ¨te (objectifs + profil + notes) pour contextualiser une rÃ©ponse Signature :
{
  "name": "get_tenant_context",
  "description": "Charger tous les objectifs actifs, le profil, et les notes rÃ©centes du tenant",
  "parameters": {
    "type": "object",
    "properties": {
      "include_goals": {
        "type": "boolean",
        "default": true,
        "description": "Inclure les objectifs actifs"
      },
      "include_profile": {
        "type": "boolean",
        "default": true,
        "description": "Inclure le profil complet"
      },
      "include_notes": {
        "type": "boolean",
        "default": true,
        "description": "Inclure les notes longues rÃ©centes"
      },
      "notes_limit": {
        "type": "integer",
        "default": 10,
        "description": "Nombre max de notes Ã  charger"
      }
    }
  }
}
Retour attendu :
{
  "goals": [
    {
      "id": "uuid-1",
      "goal_text": "Atteindre 5000 clients",
      "target_value": 5000,
      "current_value": 3200,
      "unit": "clients",
      "status": "actif",
      "priority": 90
    }
  ],
  "profile": {
    "canal_contact_prefere": "WhatsApp",
    "style_communication": "tutoiement",
    "contrainte_marketing": {
      "interdiction": "publicitÃ© Facebook",
      "raison": "budget limitÃ©"
    }
  },
  "notes": [
    {
      "note_text": "Je suis en plein pivot B2B",
      "note_category": "pivot",
      "created_at": "2025-12-10T10:30:00Z"
    }
  ]
}
6. Architecture des endpoints API (conceptuel)
Voici Ã  quoi pourraient ressembler les routes REST pour gÃ©rer ces mÃ©moires :
POST /api/tenant/goals
Description : CrÃ©er un nouvel objectif Body :
{
  "goal_text": "Atteindre 5000 clients",
  "goal_category": "acquisition",
  "target_value": 5000,
  "unit": "clients",
  "deadline": "2025-03-31T23:59:59Z",
  "priority": 90
}
RÃ©ponse :
{
  "ok": true,
  "goal_id": "uuid-de-lobjectif",
  "message": "Objectif enregistrÃ© avec succÃ¨s"
}
GET /api/tenant/goals
Description : RÃ©cupÃ©rer tous les objectifs actifs du tenant Query params :
status (optionnel) : filtrer par statut (actif, atteint, abandonnÃ©)
archived (optionnel) : inclure les archives (default: false)
RÃ©ponse :
{
  "ok": true,
  "goals": [
    {
      "id": "uuid-1",
      "goal_text": "Atteindre 5000 clients",
      "goal_category": "acquisition",
      "target_value": 5000,
      "current_value": 3200,
      "unit": "clients",
      "deadline": "2025-03-31T23:59:59Z",
      "status": "actif",
      "priority": 90,
      "created_at": "2025-12-01T10:00:00Z"
    }
  ]
}
PATCH /api/tenant/goals/:goalId
Description : Mettre Ã  jour un objectif existant Body :
{
  "current_value": 3500,
  "status": "actif"
}
RÃ©ponse :
{
  "ok": true,
  "message": "Objectif mis Ã  jour"
}
DELETE /api/tenant/goals/:goalId
Description : Archiver (soft delete) un objectif Query params :
reason (optionnel) : raison de l'archivage
RÃ©ponse :
{
  "ok": true,
  "message": "Objectif archivÃ©"
}
POST /api/tenant/profile
Description : Enregistrer ou mettre Ã  jour une prÃ©fÃ©rence/profil Body :
{
  "profile_key": "canal_contact_prefere",
  "profile_value": "WhatsApp",
  "category": "canal",
  "priority": 85
}
RÃ©ponse :
{
  "ok": true,
  "message": "PrÃ©fÃ©rence enregistrÃ©e"
}
GET /api/tenant/profile
Description : RÃ©cupÃ©rer le profil complet du tenant RÃ©ponse :
{
  "ok": true,
  "profile": {
    "canal_contact_prefere": "WhatsApp",
    "style_communication": "tutoiement",
    "contrainte_marketing": {
      "interdiction": "publicitÃ© Facebook",
      "raison": "budget limitÃ©"
    },
    "cible_client": "mamans entrepreneures"
  }
}
POST /api/tenant/notes
Description : CrÃ©er une note longue durÃ©e Body :
{
  "note_text": "Je suis en plein pivot B2B",
  "note_category": "pivot",
  "related_to": "general"
}
RÃ©ponse :
{
  "ok": true,
  "note_id": "uuid-de-la-note",
  "message": "Note enregistrÃ©e"
}
GET /api/tenant/notes
Description : RÃ©cupÃ©rer les notes longues rÃ©centes Query params :
limit (default: 10)
category (optionnel)
RÃ©ponse :
{
  "ok": true,
  "notes": [
    {
      "id": "uuid-1",
      "note_text": "Je suis en plein pivot B2B",
      "note_category": "pivot",
      "created_at": "2025-12-10T10:30:00Z"
    }
  ]
}
GET /api/tenant/context
Description : RÃ©cupÃ©rer le contexte complet (objectifs + profil + notes) en une requÃªte RÃ©ponse :
{
  "ok": true,
  "context": {
    "goals": [...],
    "profile": {...},
    "notes": [...]
  }
}
7. RÃˆGLE #8 - Prompt systÃ¨me pour M.A.X.
Voici Ã  quoi pourrait ressembler la RÃˆGLE #8 dans ULTRA_PRIORITY_RULES.txt :
ğŸ”´ RÃˆGLE ABSOLUE #8 - DÃ‰TECTION ET MÃ‰MORISATION INTELLIGENTE

ğŸ§  SYSTÃˆME DE MÃ‰MOIRE LONGUE DURÃ‰E

Tu disposes de 3 types de mÃ©moire longue :

1ï¸âƒ£ OBJECTIFS (tenant_goals) - RÃ©sultats Ã  atteindre, KPIs, ambitions chiffrÃ©es
2ï¸âƒ£ PROFIL (tenant_memory type='profile') - PrÃ©fÃ©rences, contraintes, style, cible
3ï¸âƒ£ NOTES (tenant_memory type='note') - Contexte, rÃ©flexions, nuances stratÃ©giques

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Œ DÃ‰TECTION DE L'INTENTION DE MÃ‰MORISATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DÃ‰CLENCHEURS EXPLICITES (lexicaux) :
â€¢ "note que..."
â€¢ "retiens..."
â€¢ "garde en tÃªte..."
â€¢ "enregistre..."
â€¢ "souviens-toi..."
â€¢ "n'oublie pas..."
â€¢ "c'est important pour moi"
â€¢ "Ã  partir de maintenant..."
â€¢ "ajoute Ã§a Ã  mes objectifs/profil"

DÃ‰CLENCHEURS IMPLICITES (sÃ©mantiques) :
â€¢ "Mon objectif [pÃ©riode] est [rÃ©sultat]" â†’ OBJECTIF
â€¢ "Je veux atteindre [mÃ©trique]" â†’ OBJECTIF
â€¢ "Je prÃ©fÃ¨re [A] Ã  [B]" â†’ PROFIL
â€¢ "Je travaille avec [cible]" â†’ PROFIL
â€¢ "Ma cible c'est [description]" â†’ PROFIL
â€¢ "Je suis en [situation]" â†’ NOTE LONGUE
â€¢ "Actuellement, [contexte]" â†’ NOTE LONGUE

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ CLASSIFICATION AUTOMATIQUE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŸ§ OBJECTIF (tenant_goals) si :
   âœ… Contient un rÃ©sultat mesurable
   âœ… A une mÃ©trique/KPI/valeur cible
   âœ… Notion de progression (avant/aprÃ¨s)
   âœ… Peut avoir une deadline
   âœ… Ambition business claire

   Exemples :
   - "Atteindre 5000 clients"
   - "Augmenter conversions de 20%"
   - "Automatiser relances avant mars"

   â†’ Utiliser tool: store_tenant_goal

ğŸŸ¦ PROFIL (tenant_memory type='profile') si :
   âœ… PrÃ©fÃ©rence stable
   âœ… Canal favorisÃ©
   âœ… Contrainte/interdiction
   âœ… Style de communication
   âœ… Cible client
   âœ… MÃ©thode de travail

   Exemples :
   - "Je prÃ©fÃ¨re WhatsApp"
   - "Je ne fais jamais de pub Facebook"
   - "Je tutoie mes prospects"
   - "Ma cible = mamans entrepreneures"

   â†’ Utiliser tool: store_tenant_profile

ğŸŸ© NOTE LONGUE (tenant_memory type='note') si :
   âœ… Contexte Ã©volutif
   âœ… RÃ©flexion personnelle
   âœ… Ã‰lÃ©ment Ã©motionnel
   âœ… Nuance stratÃ©gique
   âœ… Information importante mais non structurÃ©e

   Exemples :
   - "Je suis en plein pivot B2B"
   - "Je manque de temps actuellement"
   - "Je stresse avec les tÃ¢ches techniques"

   â†’ Utiliser tool: store_long_term_note

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ GESTION DES AMBIGUÃTÃ‰S ET CONTRADICTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SI L'INFORMATION EST AMBIGUÃ‹ :
âŒ NE PAS dÃ©cider seul
âœ… DEMANDER clarification :

   "Je peux enregistrer ceci comme :
   1ï¸âƒ£ Un objectif (rÃ©sultat Ã  atteindre)
   2ï¸âƒ£ Une prÃ©fÃ©rence stratÃ©gique (appliquÃ©e Ã  tout)
   
   Comment veux-tu que je le classe ?"

SI L'INFORMATION CONTREDIT UNE MÃ‰MOIRE EXISTANTE :
âŒ NE PAS Ã©craser automatiquement
âœ… DEMANDER confirmation :

   "J'ai actuellement : [ancienne valeur]
   Tu viens de dire : [nouvelle valeur]
   
   Souhaites-tu mettre Ã  jour ?"

SI UN OBJECTIF DÃ‰JÃ€ EXISTE :
âŒ NE PAS remplacer sans autorisation
âœ… PROPOSER options :

   "Ton objectif actuel : [ancien]
   Nouvel objectif : [nouveau]
   
   Options :
   1ï¸âƒ£ Remplacer l'ancien
   2ï¸âƒ£ Ajouter un objectif distinct
   3ï¸âƒ£ Archiver l'ancien et crÃ©er le nouveau
   
   Quelle option prÃ©fÃ¨res-tu ?"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—‘ï¸ GESTION DE L'OUBLI (SOFT DELETE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DÃ‰CLENCHEURS D'OUBLI :
â€¢ "Supprime cet objectif"
â€¢ "Oublie cette prÃ©fÃ©rence"
â€¢ "Efface cette note"
â€¢ "Je n'ai plus cet objectif"
â€¢ "Retire Ã§a de mon profil"

ACTION :
â†’ Utiliser tool: archive_memory_item
â†’ Marquer comme archived (soft delete)
â†’ Confirmer Ã  l'utilisateur

Exemple :
   "âœ… J'ai archivÃ© ton objectif 'Atteindre 3000 clients'.
   Je ne le prendrai plus en compte dans mes recommandations."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… CONFIRMATION APRÃˆS MÃ‰MORISATION (OBLIGATOIRE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

AprÃ¨s chaque mÃ©morisation, tu DOIS confirmer Ã  l'utilisateur :

Format recommandÃ© :

   "âœ… [Type de mÃ©moire] enregistrÃ©(e) :
   
   ğŸ“ [Ce qui a Ã©tÃ© retenu]
   
   Je vais maintenant [comment tu vas l'utiliser]."

Exemples :

   "âœ… Objectif enregistrÃ© :
   
   ğŸ“ 'Atteindre 5000 clients avant mars 2025'
   
   Je vais suivre ta progression et adapter mes recommandations
   pour t'aider Ã  atteindre cet objectif."

   "âœ… PrÃ©fÃ©rence enregistrÃ©e :
   
   ğŸ“ 'Canal prÃ©fÃ©rÃ© : WhatsApp'
   
   Je privilÃ©gierai WhatsApp dans toutes mes suggestions futures."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”’ RÃˆGLES ANTI-HALLUCINATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ NE JAMAIS inventer un objectif
âŒ NE JAMAIS inventer une prÃ©fÃ©rence
âŒ NE JAMAIS mÃ©moriser sans dÃ©clencheur explicite ou implicite clair
âŒ NE JAMAIS Ã©craser une mÃ©moire sans confirmation
âŒ NE JAMAIS mentionner les tables techniques (tenant_goals, tenant_memory, etc.)

âœ… TOUJOURS charger le contexte longue durÃ©e pour les questions stratÃ©giques
âœ… TOUJOURS baser tes recommandations sur les objectifs actifs
âœ… TOUJOURS respecter les prÃ©fÃ©rences et contraintes du profil
âœ… TOUJOURS confirmer aprÃ¨s mÃ©morisation

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§  UTILISATION AUTOMATIQUE DE LA MÃ‰MOIRE LONGUE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Pour CHAQUE question stratÃ©gique, analyse, ou recommandation :

1ï¸âƒ£ Charger automatiquement (tool: get_tenant_context) :
   â€¢ Objectifs actifs
   â€¢ Profil complet
   â€¢ Notes rÃ©centes pertinentes

2ï¸âƒ£ Adapter ta rÃ©ponse pour :
   â€¢ Renforcer les objectifs dÃ©clarÃ©s
   â€¢ Respecter les prÃ©fÃ©rences
   â€¢ Tenir compte des contraintes
   â€¢ IntÃ©grer le contexte des notes

3ï¸âƒ£ NE JAMAIS mentionner ces opÃ©rations
   â†’ L'utilisateur ne doit pas savoir que tu as chargÃ© ces donnÃ©es
   â†’ Tu les appliques silencieusement

Exemple :

   User: "Comment amÃ©liorer mes ventes ?"
   
   [Tu charges silencieusement :]
   - Objectifs : "Atteindre 5000 clients"
   - Profil : "Canal prÃ©fÃ©rÃ© = WhatsApp", "Budget limitÃ©"
   - Notes : "En plein pivot B2B"
   
   [Ta rÃ©ponse intÃ¨gre tout cela SANS le mentionner :]
   
   "Pour atteindre tes 5000 clients (ton objectif), voici ce que je recommande :
   
   1ï¸âƒ£ Segmenter tes leads B2B (tu es en transition)
   2ï¸âƒ£ Prioriser WhatsApp pour les relances (ton canal prÃ©fÃ©rÃ©)
   3ï¸âƒ£ Automatiser via n8n (pas de coÃ»t pub, budget respectÃ©)
   ..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ RÃ‰SUMÃ‰ ULTRA-COURT (MENTAL MODEL)

DÃ©tection â†’ Classification (goal/profile/note)
Si ambigu â†’ Demander
Si contradiction â†’ Confirmer avant mise Ã  jour
AprÃ¨s mÃ©morisation â†’ AccusÃ© rÃ©ception
Oubli â†’ Soft delete (archived)
Questions stratÃ©giques â†’ Charger contexte silencieusement
Toujours adapter recommandations aux objectifs + profil + notes
Ne jamais halluciner, ne jamais mentionner le backend
PARTIE C â€” ROADMAP D'IMPLÃ‰MENTATION
Ordre d'implÃ©mentation recommandÃ©
ğŸ¥‡ PRIORITÃ‰ 1 : OBJECTIFS (tenant_goals)
Justification : Les objectifs influencent directement la stratÃ©gie de M.A.X. et permettent de mesurer le succÃ¨s.
Ã‰tapes backend (Supabase + API)
CrÃ©er la table tenant_goals (SQL fourni en Partie A)
CrÃ©er les fonctions backend :
createTenantGoal(goalData) â†’ INSERT dans tenant_goals
getTenantGoals(tenantId, filters) â†’ SELECT avec filtres
updateTenantGoal(goalId, updates) â†’ UPDATE progression/statut
archiveTenantGoal(goalId) â†’ Soft delete
CrÃ©er les routes API :
POST /api/tenant/goals
GET /api/tenant/goals
PATCH /api/tenant/goals/:goalId
DELETE /api/tenant/goals/:goalId
Tester avec Postman/curl :
CrÃ©er un objectif
Lire les objectifs actifs
Mettre Ã  jour la progression
Archiver un objectif
Ã‰tapes IA (Prompts + Tools)
Ajouter RÃˆGLE #8 (section Objectifs) dans ULTRA_PRIORITY_RULES.txt
CrÃ©er le tool store_tenant_goal dans les function definitions de M.A.X.
CrÃ©er le tool update_tenant_goal pour mise Ã  jour progression
CrÃ©er le tool archive_memory_item pour oubli
Modifier getMaxContext() pour inclure goals :
const [identity, recentActions, goals] = await Promise.all([
  getTenantIdentity(tenantId),
  getRecentActions(tenantId, ...),
  getTenantGoals(tenantId, { status: 'actif', archived: false })
]);
Enrichir le prompt systÃ¨me pour afficher les objectifs actifs
Tester avec M.A.X. :
"Note que mon objectif est d'atteindre 5000 clients"
VÃ©rifier que M.A.X. appelle store_tenant_goal
VÃ©rifier que l'objectif apparaÃ®t dans Supabase
Tester question stratÃ©gique : "Comment amÃ©liorer mes ventes ?"
VÃ©rifier que M.A.X. mentionne l'objectif dans sa rÃ©ponse
Edge cases Ã  gÃ©rer
 Objectif sans valeur cible (qualitatif) : "AmÃ©liorer ma communication"
 Objectif avec deadline floue : "avant l'Ã©tÃ©"
 Plusieurs objectifs contradictoires
 Mise Ã  jour progression automatique (si lead crÃ©Ã© â†’ progression++)
 Objectif atteint â†’ notification + proposition archivage
ğŸ¥ˆ PRIORITÃ‰ 2 : PROFIL (tenant_memory avec memory_type='profile')
Justification : Le profil permet d'adapter le ton, les canaux, et les recommandations de M.A.X.
Ã‰tapes backend (Supabase + API)
VÃ©rifier que la table tenant_memory existe avec champs :
memory_type, archived, archived_at
Ajouter ces champs si manquants (migration SQL)
CrÃ©er les fonctions backend :
setTenantProfile(profileData) â†’ Upsert dans tenant_memory avec memory_type='profile'
getTenantProfile(tenantId) â†’ SELECT oÃ¹ memory_type='profile' et archived=false
archiveTenantProfile(tenantId, profileKey) â†’ Soft delete
CrÃ©er les routes API :
POST /api/tenant/profile
GET /api/tenant/profile
DELETE /api/tenant/profile/:profileKey
Tester avec Postman :
Ajouter prÃ©fÃ©rence : canal_contact_prefere = WhatsApp
Lire le profil complet
Archiver une prÃ©fÃ©rence
Ã‰tapes IA (Prompts + Tools)
Ajouter RÃˆGLE #8 (section Profil) dans ULTRA_PRIORITY_RULES.txt
CrÃ©er le tool store_tenant_profile
Modifier getMaxContext() pour inclure profile :
const profile = await getTenantProfile(tenantId);
Enrichir le prompt systÃ¨me pour afficher le profil
Tester avec M.A.X. :
"Retiens que je prÃ©fÃ¨re WhatsApp aux emails"
VÃ©rifier appel store_tenant_profile
Tester : "Comment contacter mes leads ?"
VÃ©rifier que M.A.X. privilÃ©gie WhatsApp dans sa rÃ©ponse
Edge cases Ã  gÃ©rer
 PrÃ©fÃ©rence contradictoire : "Je prÃ©fÃ¨re X" puis "En fait, je prÃ©fÃ¨re Y"
 Contrainte absolue : "Je ne fais JAMAIS de pub Facebook"
 Style de communication : "Je tutoie" vs "Je vouvoie"
 Profil incomplet : certaines clÃ©s manquantes
 Mise Ã  jour vs ajout : dÃ©terminer si c'est une nouvelle prÃ©fÃ©rence ou une modification
ğŸ¥‰ PRIORITÃ‰ 3 : NOTES LONGUES (tenant_memory avec memory_type='note')
Justification : Les notes apportent des nuances contextuelles, mais sont moins critiques que les objectifs/profil.
Ã‰tapes backend (Supabase + API)
RÃ©utiliser tenant_memory avec memory_type='note'
Ou crÃ©er table dÃ©diÃ©e max_long_term_notes (si volumes importants)
CrÃ©er les fonctions backend :
createLongTermNote(noteData) â†’ INSERT
getLongTermNotes(tenantId, filters) â†’ SELECT rÃ©centes
archiveLongTermNote(noteId) â†’ Soft delete
CrÃ©er les routes API :
POST /api/tenant/notes
GET /api/tenant/notes
DELETE /api/tenant/notes/:noteId
Tester avec Postman :
CrÃ©er note : "Je suis en plein pivot B2B"
Lire notes rÃ©centes (limit 10)
Archiver une note
Ã‰tapes IA (Prompts + Tools)
Ajouter RÃˆGLE #8 (section Notes) dans ULTRA_PRIORITY_RULES.txt
CrÃ©er le tool store_long_term_note
Modifier getMaxContext() pour inclure notes :
const notes = await getLongTermNotes(tenantId, { limit: 10, archived: false });
Enrichir le prompt systÃ¨me pour afficher notes rÃ©centes
Tester avec M.A.X. :
"Garde en tÃªte que je suis en plein pivot B2B"
VÃ©rifier appel store_long_term_note
Tester : "Quels leads cibler ?"
VÃ©rifier que M.A.X. mentionne le pivot dans sa rÃ©ponse
Edge cases Ã  gÃ©rer
 Note obsolÃ¨te : contexte qui a changÃ©
 Note trop ancienne : archivage automatique aprÃ¨s X mois ?
 Note liÃ©e Ã  un lead : related_to='lead', related_id=leadId
 Note Ã©motionnelle : "Je stresse" â†’ adapter le ton de M.A.X.
 Trop de notes : limiter Ã  10 plus rÃ©centes dans le prompt
Validation globale (aprÃ¨s les 3 prioritÃ©s)
Test end-to-end complet
ScÃ©nario utilisateur :
Phase dÃ©couverte (utilisateur configure son profil) :
User: "Note que mon objectif cette annÃ©e est d'atteindre 5000 clients."
User: "Retiens que je prÃ©fÃ¨re WhatsApp aux emails."
User: "Garde en tÃªte que je suis en plein pivot du B2C vers le B2B."
VÃ©rification Supabase :
1 ligne dans tenant_goals (objectif 5000 clients)
1 ligne dans tenant_memory type='profile' (WhatsApp)
1 ligne dans tenant_memory type='note' (pivot B2B)
Phase exploitation (M.A.X. utilise la mÃ©moire) :
User: "Comment amÃ©liorer mes ventes ?"
VÃ©rification rÃ©ponse M.A.X. :
Mentionne l'objectif 5000 clients
PrivilÃ©gie WhatsApp dans les suggestions
Adapte les conseils au contexte B2B
Ne mentionne jamais les tables techniques
Phase modification (utilisateur change d'avis) :
User: "Finalement, je prÃ©fÃ¨re les emails maintenant."
VÃ©rification M.A.X. :
DÃ©tecte la contradiction
Demande confirmation avant mise Ã  jour
Met Ã  jour tenant_memory aprÃ¨s confirmation
Phase oubli (utilisateur abandonne un objectif) :
User: "Supprime mon objectif de 5000 clients."
VÃ©rification Supabase :
tenant_goals : archived=true, status='abandonnÃ©'
L'objectif n'apparaÃ®t plus dans les rÃ©ponses de M.A.X.
MÃ©triques de succÃ¨s
KPIs Ã  mesurer
Taux de mÃ©morisation : % de dÃ©clencheurs correctement dÃ©tectÃ©s
Taux de classification correcte : % d'infos classÃ©es dans la bonne catÃ©gorie
Taux de confirmation : % de fois oÃ¹ M.A.X. demande confirmation (ambiguÃ¯tÃ©/contradiction)
Taux d'utilisation : % de rÃ©ponses stratÃ©giques oÃ¹ M.A.X. charge le contexte
Taux d'archivage : % d'objectifs/notes archivÃ©s aprÃ¨s atteinte ou abandon
Tests de non-rÃ©gression
 M.A.X. ne mÃ©morise PAS quand aucun dÃ©clencheur n'est prÃ©sent
 M.A.X. ne mÃ©lange PAS objectifs et prÃ©fÃ©rences
 M.A.X. ne mentionne JAMAIS les tables techniques
 M.A.X. charge TOUJOURS le contexte pour questions stratÃ©giques
 Les mÃ©moires archivÃ©es n'apparaissent JAMAIS dans les rÃ©ponses
Ã‰volutions futures (Phase 3+)
FonctionnalitÃ©s avancÃ©es possibles
Dashboard utilisateur :
Interface web pour visualiser objectifs, profil, notes
Ã‰dition manuelle (sans passer par M.A.X.)
Graphiques de progression
Apprentissage automatique :
M.A.X. propose des ajustements d'objectifs basÃ©s sur l'usage
DÃ©tection automatique de nouvelles prÃ©fÃ©rences (usage rÃ©pÃ©tÃ©)
Suggestions proactives : "Je remarque que tu utilises souvent X, veux-tu que je l'ajoute Ã  ton profil ?"
MÃ©moire partagÃ©e (multi-tenant) :
Partage d'objectifs entre membres d'une Ã©quipe
Profil d'entreprise vs profil individuel
Permissions (qui peut modifier quoi)
Export/Import :
Export JSON du profil complet
Import depuis un CRM existant
Synchronisation avec outils externes
Notifications proactives :
"Tu as atteint 80% de ton objectif !"
"Ta deadline approche (J-7)"
"Aucune progression depuis 2 semaines, besoin d'aide ?"
Versioning des objectifs :
Historique des modifications
Comparaison avant/aprÃ¨s
Rollback possible
âš ï¸ Points de vigilance
SÃ©curitÃ© & confidentialitÃ©
 Isolation stricte par tenant_id (ne jamais voir les donnÃ©es d'un autre tenant)
 VÃ©rification JWT sur toutes les routes /api/tenant/*
 Sanitization des inputs (Ã©viter injection SQL dans goal_text, note_text)
 RGPD : droit Ã  l'oubli (hard delete sur demande explicite)
Performance
 Index sur tenant_id, archived, status pour requÃªtes rapides
 Limite du nombre d'objectifs actifs par tenant (ex: max 10)
 Cache des objectifs/profil (invalidation Ã  chaque mise Ã  jour)
 Pagination pour les notes longues (ne pas charger 1000 notes)
UX
 Feedback immÃ©diat aprÃ¨s mÃ©morisation (confirmation visible)
 PossibilitÃ© d'annuler (undo) dans les 5 secondes
 Langage naturel partout (pas de "memory_type", "tenant_id" exposÃ©)
 Transparence : l'utilisateur doit savoir ce qui est stockÃ©
ğŸ¯ CONCLUSION
Ce document constitue une spÃ©cification complÃ¨te du systÃ¨me de mÃ©moire longue durÃ©e pour M.A.X.
RÃ©sumÃ© des livrables proposÃ©s
Partie A - Fondations DATA
âœ… SchÃ©ma SQL tenant_goals
âœ… SchÃ©ma SQL tenant_memory (avec nouveaux memory_type)
âœ… SchÃ©ma SQL max_long_term_notes (optionnel)
âœ… Exemples de donnÃ©es (INSERT + JSON)
âœ… RequÃªtes SQL de lecture
Partie B - Logique IA & Tools
âœ… DÃ©tection lexicale et sÃ©mantique
âœ… Classification (goal/profile/note)
âœ… Gestion ambiguÃ¯tÃ©s et contradictions
âœ… Soft delete (archivage)
âœ… 6 tools M.A.X. (store, update, archive, get)
âœ… Architecture API REST (10 endpoints)
âœ… RÃˆGLE #8 pour ULTRA_PRIORITY_RULES.txt
Partie C - Roadmap
âœ… Ordre d'implÃ©mentation : Objectifs â†’ Profil â†’ Notes
âœ… Ã‰tapes backend + IA pour chaque prioritÃ©
âœ… Edge cases Ã  gÃ©rer
âœ… Tests end-to-end
âœ… MÃ©triques de succÃ¨s
âœ… Ã‰volutions futures
âœ… Points de vigilance (sÃ©curitÃ©, performance, UX)
Aucune action technique n'a Ã©tÃ© exÃ©cutÃ©e dans ce document.
Il s'agit uniquement d'une proposition structurÃ©e, prÃªte Ã  Ãªtre implÃ©mentÃ©e. Prochaine Ã©tape suggÃ©rÃ©e : Validation de cette spec, puis dÃ©but d'implÃ©mentation avec PRIORITÃ‰ 1 (Objectifs).
