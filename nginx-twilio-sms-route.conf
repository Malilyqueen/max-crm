# ============================================================================
# NGINX ROUTE: Twilio SMS Webhooks
# Ã€ ajouter dans: /opt/max-infrastructure/nginx/conf.d/api.conf
# ============================================================================

# Webhook Twilio SMS - Messages entrants
location /webhooks/twilio-sms/incoming {
    limit_req zone=webhook_limit burst=50 nodelay;
    proxy_pass http://max_backend;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header Connection "";
    proxy_read_timeout 60s;
    proxy_connect_timeout 10s;
}

# Webhook Twilio SMS - Status callbacks
location /webhooks/twilio-sms/status {
    limit_req zone=webhook_limit burst=50 nodelay;
    proxy_pass http://max_backend;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header Connection "";
    proxy_read_timeout 60s;
    proxy_connect_timeout 10s;
}

# Webhook Twilio SMS - Healthcheck
location /webhooks/twilio-sms/status-check {
    proxy_pass http://max_backend;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    access_log off;
}